# TelegramBotYoutubeVK
This is the bot, which can download videos from YT and convert them to MP3. Also it can download VK Videos and Clips and Stories without watermarks

Bot works with SQlite3 db now

Этот код представляет собой бота для Telegram, который позволяет пользователям загружать видео и аудио с YouTube и VK, выбирая различные форматы и качество. Он использует библиотеки `telegram`, `telegram.ext`, `yt_dlp`, `os`, `logging`, и `asyncio` для обработки запросов, скачивания медиа и организации процесса загрузки.

### Обзор используемых библиотек

1. **os** — модуль Python, предоставляющий функции для взаимодействия с файловой системой и операционной средой. Здесь используется для проверки размера файлов и их удаления после отправки.
2. **logging** — модуль для ведения журналов (логирования) действий. В коде настраивается базовый логгинг, чтобы отслеживать информацию о работе бота, ошибки и другие сообщения.
3. **asyncio** — библиотека для написания асинхронного кода. Асинхронные функции позволяют ботам обрабатывать несколько задач параллельно, улучшая скорость и отзывчивость.
4. **telegram и telegram.ext** — библиотека для создания ботов Telegram, в которой `telegram` содержит базовые компоненты, такие как `Bot` и `Update`, а `telegram.ext` предоставляет высокоуровневые компоненты, такие как `ApplicationBuilder` и `ConversationHandler`.
5. **yt_dlp** — библиотека для загрузки видео с различных сайтов, включая YouTube и VK. Она позволяет получить информацию о доступных форматах видео и скачать его в определенном формате.

### Основные компоненты и их функции

#### 1. Настройка логирования
```python
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
```
Настраивает базовое логирование, выводя сообщения о действиях бота, уровне важности события и времени.

#### 2. Определение состояний
Константы (`START`, `GET_URL`, `PROCESS`, `SELECT_QUALITY`, `END`) задают этапы общения с ботом в формате конечного автомата. Каждое состояние отвечает за определенный шаг диалога.

#### 3. Обработчики команд
- **start**: Запускает диалог с приветствием и отправляет пользователю кнопки для выбора действий.
- **get_url**: Запрашивает ссылку YouTube или VK у пользователя.
- **process_url**: Проверяет тип ссылки (YouTube или VK), запоминает его, и предлагает действия (конвертация в MP3 или скачивание видео).
- **handle_action_selection**: Определяет, какую операцию выполнить — загрузку аудио, видео, или выбор качества.
- **handle_quality_selection**: Позволяет пользователю выбрать качество видео, загружая его в указанном формате.

#### 4. Вспомогательные функции
- **detect_link_type(url)**: Определяет, принадлежит ли URL к YouTube или VK.
- **send_file**: Отправляет файл пользователю, проверяя его размер и тип, чтобы соответствовать ограничениям Telegram.
- **stop_conversation**: Завершает диалог и отправляет сообщение прощания.
- **get_available_formats**: Возвращает список доступных форматов для загрузки видео с аудио- и видеокодеками.
- **download_audio**: Загружает аудио с YouTube в формате MP3.
- **download_video_with_quality**: Загружает видео с YouTube с указанным качеством.
- **download_vk_clip**: Загружает видео с VK.

#### 5. Основная функция `main`
Создает экземпляр бота, настраивает обработчики команд и запускает бот в режиме опроса (polling).

Эта архитектура делает бота интерактивным, добавляя пользователю гибкость при выборе действий, и соблюдает ограничения Telegram по размеру файлов, проверяя его перед отправкой.
